version: '3.8'

services:
  # 1. SERVICIO DE LA BASE DE DATOS POSTGRESQL
  db:
    image: postgres:16-alpine # Usamos una imagen ligera de PostgreSQL
    container_name: hotel_db
    restart: always
    environment:
      # Los valores deben coincidir con application.properties de Spring Boot
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin1234
      POSTGRES_DB: hotel_db
    ports:
      - "5432:5432" # Mapea el puerto de PostgreSQL al host
    volumes:
      # Persiste los datos en un volumen para que no se pierdan si se detiene el contenedor
      - db_data:/var/lib/postgresql/data

  # 2. SERVICIO DE LA APLICACIÓN SPRING BOOT
  app:
    # Debes construir primero la imagen de tu aplicación Spring Boot (ej. con 'docker build')
    # O usar 'build: .' si vas a construir desde un Dockerfile
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hotel_api
    ports:
      - "8080:8080"
    depends_on:
      - db # Asegura que la DB se levante antes que la app
    environment:
      # Sobreescribe la URL de conexión para usar el nombre del servicio de Docker (db)
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/hotel_db
      SPRING_DATASOURCE_USERNAME: admin
      SPRING_DATASOURCE_PASSWORD: admin1234

volumes:
  # Define el volumen para la persistencia de datos de PostgreSQL
  db_data:
